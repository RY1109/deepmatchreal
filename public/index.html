<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DeepMatch Pro</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- 顶部固定工具栏 -->
        <!-- 1. 给顶部工具栏加 ID="topToolbar" -->
        <div class="top-toolbar" id="topToolbar">
            <div class="tool-btn">
                <i class="fas fa-user-friends" style="color: #22c55e;"></i>
                <span id="online-count">1</span>
            </div>
            <div class="tool-btn" onclick="toggleLanguage()">
                <i class="fas fa-globe"></i>
                <span id="current-lang-text">EN</span>
            </div>
        </div>
        
        <div id="offline-tip" class="status-bar" data-i18n="offlineTip">网络已断开，正在尝试重连...</div>

        <!-- 1. 首页 (Home) -->
        <div id="page-home" class="page active">
            <div class="home-container">
                <div class="brand-area">
                    <div class="logo-text" data-i18n="appTitle">DeepMatch</div>
                    <p style="color: var(--text-sub); font-size: 1.1rem;" data-i18n="appSubtitle">
                        AI 驱动的智能玩家匹配系统
                    </p>
                </div>
                
                <div class="input-box-lg">
                    <textarea id="userInput" class="main-input" data-i18n-placeholder="inputPlaceholder" placeholder="输入话题..."></textarea>
                    
                    <div class="action-row">
                        <button id="btnStart" class="btn-primary" onclick="startMatching()">
                            <span data-i18n="btnStart">开始深度匹配</span> 
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. 加载页 -->
        <div id="page-loading" class="page">
            <div class="loading-container">
                <i class="fas fa-circle-notch fa-spin spinner-lg"></i>
                <h3 style="color: var(--text-main); margin-bottom: 10px;" id="loading-text" data-i18n="loadingText">正在寻找伙伴...</h3>
                <button onclick="location.reload()" style="border:none; background:none; color: var(--text-sub); cursor:pointer; font-size: 0.9rem;" data-i18n="btnCancel">取消请求</button>
            </div>
        </div>

        <!-- 3. 聊天页 (Chat) -->
        <div id="page-chat" class="page">
            <div class="chat-layout">
                <header class="chat-header">
                    <div class="user-meta">
                        <!-- ✅ 修复：使用 header-avatar 类来限制大小 -->
                        <img id="partner-avatar-img" class="header-avatar" src="">
                        <div>
                            <div style="font-weight: 700; font-size: 1rem; color: var(--text-main); max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" 
                                id="partner-name" data-i18n="partnerName">神秘玩家</div>
                            <div style="font-size: 0.75rem; color: #22c55e; display:flex; align-items:center; gap:4px;">
                                <span style="width:6px; height:6px; background:#22c55e; border-radius:50%; display:inline-block;"></span> 
                                <span id="match-status">在线</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ✅ 修复：全新的幽灵按钮样式 -->
                    <button class="btn-end-chat" onclick="clearSession()">
                        <span data-i18n="btnExit">结束对话</span>
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </header>

                <div class="chat-messages" id="chatBody"></div>

                <div class="typing-status" id="typing-indicator" style="position:absolute; bottom:80px; left:24px; font-size:0.75rem; color:#94a3b8; display:none;">
                    <i class="fas fa-pen-nib"></i> <span data-i18n="typing">对方正在输入...</span>
                </div>

                <div class="chat-footer">
                    <div class="input-pill">
                        <input type="text" class="chat-input" id="chatInput" data-i18n-placeholder="chatPlaceholder" placeholder="发送消息..." autocomplete="off">
                        <button class="btn-send-square" onclick="sendMsg()">
                            <i class="fas fa-arrow-up"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 脚本 -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/app.js"></script>
</body>
</html>