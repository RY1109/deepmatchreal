<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 关键：禁止缩放，保证移动端体验像原生App -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DeepMatch Pro</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- 语言切换 -->
        <div class="lang-switch" onclick="toggleLanguage()">
            <i class="fas fa-globe"></i> <span id="current-lang-text">EN</span>
        </div>
        
        <!-- 断网提示 -->
        <div id="offline-tip" class="status-bar" data-i18n="offlineTip">网络已断开，正在尝试重连...</div>

        <!-- 1. 给顶部工具栏加 ID="topToolbar" -->
        <div class="top-toolbar" id="topToolbar">
            <div class="tool-btn">
                <i class="fas fa-user-friends" style="color: #22c55e;"></i>
                <span id="online-count">1</span>
            </div>
            <div class="tool-btn" onclick="toggleLanguage()">
                <i class="fas fa-globe"></i>
                <span id="current-lang-text">EN</span>
            </div>
        </div>

        <!-- 1. 首页 -->
        <div id="page-home" class="page active">
            <div class="home-content">
                <div class="hero-title" data-i18n="appTitle">DeepMatch</div>
                <div class="online-badge">🟢 <span data-i18n="onlineLabel">当前在线</span>: <span id="online-count">1</span></div>
                <div class="input-wrapper">
                    <textarea id="userInput" data-i18n-placeholder="inputPlaceholder" placeholder="输入话题..."></textarea>
                    <div style="overflow: hidden;">
                        <button class="btn-start" onclick="startMatching()">
                            <span data-i18n="btnStart">开始匹配</span> <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. 加载页 -->
        <div id="page-loading" class="page" style="align-items: center; justify-content: center;">
            <i class="fas fa-circle-notch fa-spin" style="font-size: 2rem; color: var(--ds-blue);"></i>
            <p style="margin-top: 20px; color: var(--text-sub);" id="loading-text" data-i18n="loadingText">正在寻找伙伴...</p>
            <button onclick="location.reload()" style="margin-top: 30px; border:none; background:none; color:#999;" data-i18n="btnCancel">取消</button>
        </div>

        <!-- 3. 聊天页 -->
        <div id="page-chat" class="page">
            <header class="chat-header">
                <div class="user-meta">
                    <img id="partner-avatar-img" class="avatar-lg" src="">
                    <div>
                        <div style="font-weight: 700; font-size: 1.1rem; color: var(--text-main); max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" id="partner-name" data-i18n="partnerName">神秘玩家</div>
                        <div style="font-size: 0.8rem; color: #22c55e;" id="match-status">● 在线</div>
                    </div>
                </div>
                
                <!-- ✅ 全新设计的退出按钮 -->
                <button class="btn-exit-pill" onclick="clearSession()">
                    <i class="fas fa-power-off"></i>
                    <span data-i18n="btnExit">结束聊天</span>
                </button>
            </header>

            <div class="chat-body" id="chatBody"></div>

            <div class="typing-indicator" id="typing-indicator">
                <div class="dot"></div><div class="dot"></div><div class="dot"></div> <span data-i18n="typing">对方正在输入...</span>
            </div>

            <div class="input-bar">
                <input type="text" class="chat-input" id="chatInput" data-i18n-placeholder="chatPlaceholder" placeholder="发消息..." autocomplete="off">
                <!-- ✅ 修改点：使用 btn-send 类，去掉内联样式 -->
                <button class="btn-send" onclick="sendMsg()">
                    <i class="fas fa-arrow-up"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 脚本引入 -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/app.js"></script>
</body>
</html>